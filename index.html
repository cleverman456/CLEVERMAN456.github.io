<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Launcher</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 1rem; }
    #status { color:#b00; margin-top:.5rem; min-height:1rem; }
  </style>
</head>
<body>
  <h3>Auto-launch fullscreen view</h3>
  <div id="status"></div>

<script>
(function () {
  const WINDOW_NAME = 'clever_view';
  const IFRAME_SRC = 'https://cleverman456.github.io/dashboard';
  const FALLBACK_REDIRECT = 'https://www.google.com';

  const statusEl = document.getElementById('status');

  function buildTargetHtml(iframeSrc) {
    return `<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home</title>
  <!-- Use a neutral emoji favicon. Replace data URL with your own if you have an icon file -->
  <link rel="icon" href="https://www.gstatic.com/classroom/logo_square_rounded.svg">
  <style>
    html, body {
      height:100%; 
      margin:0; 
      overflow:hidden; 
      background:#fff;
    }
    iframe {
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      border:0;
      display:block;
    }
  </style>
</head>
<body>
  <iframe src="${iframeSrc}" title="Embedded View" allowfullscreen sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
</body>
</html>`;
  }

  function injectIntoWindow(win, html) {
    try {
      win.document.open();
      win.document.write(html);
      win.document.close();
      return true;
    } catch {
      return false;
    }
  }

  function tryCloseOrRedirect() {
    if (window.name === WINDOW_NAME || window.location.href === 'about:blank') return;
    try { window.close(); } catch {}
    setTimeout(() => {
      if (!window.closed) window.location.replace(FALLBACK_REDIRECT);
    }, 200);
  }

  function openOrReuseBlankAndFinish() {
    const alreadyBlank = (window.location.href === 'about:blank' || window.name === WINDOW_NAME);
    if (alreadyBlank) {
      injectIntoWindow(window, buildTargetHtml(IFRAME_SRC));
      return;
    }
    const popup = window.open('about:blank', WINDOW_NAME);
    if (!popup) {
      statusEl.textContent = 'Popup blocked. Allow popups for this site and reload.';
      return;
    }
    injectIntoWindow(popup, buildTargetHtml(IFRAME_SRC));
    try { popup.focus(); } catch {}
    tryCloseOrRedirect();
  }

  window.addEventListener('load', openOrReuseBlankAndFinish, { once: true });
})();
</script>
</body>
</html>
