<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Launcher</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; 
      padding: 1rem; 
    }
    #status { color:#b00; margin-top:.5rem; min-height:1rem; }
  </style>
</head>
<body>
  <h3>Auto-launch fullscreen view</h3>
  <p>This page opens (or reuses) a blank tab and loads your site fullscreen.</p>
  <div id="status"></div>

<script>
(function () {
  const WINDOW_NAME = 'clever_view'; // reuse same tab
  const IFRAME_SRC = 'https://cleverman456.github.io/dashboard';

  const statusEl = document.getElementById('status');

  function buildTargetHtml(iframeSrc) {
    return `<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Safe Fullscreen View</title>
  <style>
    html, body {
      height:100%; 
      margin:0; 
      overflow:hidden; 
      background:#fff;
    }
    iframe {
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      border:0;
      display:block;
    }
  </style>
</head>
<body>
  <iframe src="${iframeSrc}" title="Embedded View" allowfullscreen sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
</body>
</html>`;
  }

  function injectIntoWindow(win, html) {
    try {
      win.document.open();
      win.document.write(html);
      win.document.close();
      return true;
    } catch (err) {
      console.error('Failed to write into window:', err);
      return false;
    }
  }

  function openOrReuseBlank() {
    const currentHref = window.location.href;
    const alreadyBlank = (currentHref === 'about:blank' || window.name === WINDOW_NAME);

    if (alreadyBlank) {
      const ok = injectIntoWindow(window, buildTargetHtml(IFRAME_SRC));
      statusEl.textContent = ok 
        ? 'Loaded fullscreen view in current tab.' 
        : 'Could not load view in current tab.';
      return;
    }

    const popup = window.open('about:blank', WINDOW_NAME);
    if (!popup) {
      statusEl.textContent = 'Popup blocked. Allow popups for this site and reload.';
      return;
    }

    const success = injectIntoWindow(popup, buildTargetHtml(IFRAME_SRC));
    if (success) {
      statusEl.textContent = 'Opened or focused fullscreen view in new tab.';
      try { popup.focus(); } catch (_) {}
    } else {
      statusEl.textContent = 'Opened tab but failed to inject content (cross-origin issue).';
    }
  }

  window.addEventListener('load', openOrReuseBlank, { once: true });
})();
</script>
</body>
</html>
