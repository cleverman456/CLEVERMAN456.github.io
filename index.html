<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Launcher</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 1rem; }
    #status { color:#b00; margin-top:.5rem; min-height:1rem; }
  </style>
</head>
<body>
  <h3>Auto-launch fullscreen view</h3>
  <div id="status"></div>

<script>
(function () {
  const WINDOW_NAME = 'clever_view';
  const IFRAME_SRC = 'https://cleverman456.github.io/dashboard';
  const FALLBACK_REDIRECT = 'https://www.google.com';
  const STORAGE_KEY = 'aboutblank_html_cache';

  const statusEl = document.getElementById('status');

  function buildTargetHtml(iframeSrc) {
    return `<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home</title>
  <link rel="icon" href="https://www.gstatic.com/classroom/logo_square_rounded.svg">
  <style>
    html, body {
      height:100%;
      margin:0;
      overflow:hidden;
      background:#fff;
    }
    iframe {
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      border:0;
      display:block;
    }
  </style>
</head>
<body>
  <iframe src="${iframeSrc}" title="Embedded View" allowfullscreen sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
</body>
</html>`;
  }

  function injectIntoWindow(win, html) {
    try {
      win.document.open();
      win.document.write(html);
      win.document.close();
      return true;
    } catch {
      return false;
    }
  }

  function tryCloseOrRedirect() {
    if (window.name === WINDOW_NAME || window.location.href === 'about:blank') return;
    try { window.close(); } catch {}
    setTimeout(() => {
      if (!window.closed) window.location.replace(FALLBACK_REDIRECT);
    }, 200);
  }

  function openOrReuseBlankAndFinish() {
    const alreadyBlank = (window.location.href === 'about:blank' || window.name === WINDOW_NAME);

    // if already in about:blank, restore the cached HTML
    if (alreadyBlank) {
      const cached = localStorage.getItem(STORAGE_KEY);
      if (cached) {
        injectIntoWindow(window, cached);
      } else {
        const html = buildTargetHtml(IFRAME_SRC);
        injectIntoWindow(window, html);
        localStorage.setItem(STORAGE_KEY, html);
      }
      return;
    }

    // open new about:blank window
    const popup = window.open('about:blank', WINDOW_NAME);
    if (!popup) {
      statusEl.textContent = 'Popup blocked. Allow popups for this site and reload.';
      return;
    }

    const html = buildTargetHtml(IFRAME_SRC);
    localStorage.setItem(STORAGE_KEY, html);
    injectIntoWindow(popup, html);
    try { popup.focus(); } catch {}
    tryCloseOrRedirect();
  }

  window.addEventListener('load', openOrReuseBlankAndFinish, { once: true });
})();
</script>
</body>
</html>
